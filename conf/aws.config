/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    nf-core/novametagenomics AWS configuration for Seqera Platform
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration for running on AWS Batch via Seqera Platform
----------------------------------------------------------------------------------------
*/

// AWS Batch configuration
aws {
    region = 'us-east-1'  // Default region, can be overridden
    batch {
        cliPath = '/home/ec2-user/miniconda/bin/aws'
        maxParallelTransfers = 4
        maxTransferAttempts = 3
        delayBetweenAttempts = '5 sec'
    }
}

// Process configuration for AWS Batch
process {
    executor = 'awsbatch'
    queue = 'nextflow-queue'  // Default queue name
    
    // Resource requirements for different process labels
    withLabel: process_single {
        cpus = 1
        memory = 4.GB
        time = 2.h
    }
    
    withLabel: process_low {
        cpus = 2
        memory = 8.GB
        time = 4.h
    }
    
    withLabel: process_medium {
        cpus = 4
        memory = 16.GB
        time = 8.h
    }
    
    withLabel: process_high {
        cpus = 8
        memory = 32.GB
        time = 16.h
    }
    
    // AI-specific process configurations
    withName: 'AI_QC_FILTER' {
        cpus = 4
        memory = 16.GB
        time = 4.h
    }
    
    withName: 'DEEPVIRFINDER' {
        cpus = 4
        memory = 16.GB
        time = 6.h
    }
    
    withName: 'MEGAHIT' {
        cpus = 8
        memory = 32.GB
        time = 12.h
    }
    
    withName: 'FLYE' {
        cpus = 8
        memory = 32.GB
        time = 16.h
    }
    
    withName: 'KRAKEN2_KRAKEN2' {
        cpus = 4
        memory = 32.GB
        time = 8.h
    }
}

// Work directory on S3
workDir = 's3://your-nextflow-work-bucket/work'

// AWS-specific parameters
params {
    // S3 bucket for storing results
    outdir = 's3://your-results-bucket/novametagenomics'
    
    // Database locations on S3 (update these paths)
    kraken2_db = 's3://your-databases-bucket/kraken2/standard'
    virsorter2_db = 's3://your-databases-bucket/virsorter2/db'
    viral_protein_db = 's3://your-databases-bucket/viral_proteins/viral.dmnd'
    
    // AWS Batch specific settings
    aws_queue = 'nextflow-queue'
    aws_region = 'us-east-1'
}

// Enable Wave containers for faster startup
wave {
    enabled = true
    strategy = 'conda,container'
}

// Tower/Seqera Platform integration
tower {
    enabled = true
    endpoint = 'https://cloud.seqera.io'
}